<!doctype html>
<html lang="en">
<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" crossorigin="anonymous">
    <link rel="stylesheet" href="seatmap.canvas.css" crossorigin="anonymous">

    <title>Seatmap | Canvas by Ali Sait TEKE</title>

    <style>

        .seats_container {
            position: absolute;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: #fff;
            border: 1px solid #cbcbcb;
        }

        .buttons {
            position: absolute;
            width: 100%;
            left: 0;
            top: 0;
            z-index: 9;
        }

        .seats_container_wrapper {
            height: 500px;
            /*background: rgb(0, 165, 255);*/
        }

    </style>
</head>
<body>
<div class="container">
    <div class="row">
        <div class="col">
            <button class="btn btn-default btn-block" id="zoomout-button">Zoom-out</button>
        </div>
        <div class="col">
            <button class="btn btn-default btn-block" id="get-data">Get Selected Seat(s) Json</button>
        </div>
        <div class="col">
            <button class="btn btn-default btn-block" id="set-filter">Filter On</button>
        </div>
        <div class="col">
            <button class="btn btn-default btn-block" id="set-filter-disable">Filter of</button>
        </div>
        <div class="col">
            <button class="btn btn-default btn-block zoom-to-block" block-id="1">Zoom Block 1</button>
        </div>
        <div class="col">
            <button class="btn btn-default btn-block zoom-to-block" block-id="2">Zoom Block 2</button>
        </div>
        <div class="col">
            <button class="btn btn-default btn-block zoom-to-block" block-id="3">Zoom Block 3</button>
        </div>
    </div>
    <div class="row">
        <div class="col-sm-12 seats_container_wrapper">
            <div class="seats_container">
                <div class="buttons">
                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
<script type="text/javascript" src="seatmap.canvas.js"></script>
<script type="text/javascript">
    $(document).ready(function () {
        let seatmap = new SeatMapCanvas(".seats_container", {
            "seat_style": {
                "radius": 12,
                "color": "#ceeeff",
                "hover": "#b2d945",
                "not_salable": "#0087d0",
                "selected": "#b2d945",
                "focus": "#b2d945",
                "focus_out": "#b2d945"
            },
        });
        seatmap.eventManager.addEventListener("SEAT.CLICK", (seat) => {
            if (!seat.isSelected() && seat.item.salable === true) {
                seat.select()
            } else {
                seat.unSelect()
            }

        });

        $("#zoomout-button").on("click", function () {
            seatmap.zoomManager.zoomToVenue();
        });

        $(".zoom-to-block").on("click", function (a) {
            var blockId = parseInt($(this).attr('block-id'));
            seatmap.zoomManager.zoomToBlock(blockId);
        });

        let x_gap = 0;
        let y_gap = 0;
        let block_i = 0;

        let getDummyBlocks = function (count, cb) {
            $.getJSON("data/small.json", function (result) {
                let blocks = [];

                for (let i = 0; i < count; i++) {

                    let labels = [];
                    let label_index = {};

                    let color = "#00a5ff";

                    if (i % 2 === 0) {
                        y_gap += 400;
                        x_gap = 0;
                    } else {
                        x_gap += 400;
                    }


                    let seats = result.seats.map((item, index) => {
                        if (!label_index[item['rowName']]) {
                            var label_data = {
                                title: item['rowName'],
                                x: x_gap,
                                y: item['positionTop'] + y_gap
                            };
                            label_index[item['rowName']] = label_data;
                            labels.push(label_data);
                        }

                        let tags = [];
                        if (index % 2 === 1) {
                            tags.push("a");
                        } else {
                            tags.push("b");
                        }
                        tags.push("row_" + item.rowName);
                        return {
                            id: i + "-" + (index + 1),
                            x: item['positionLeft'] + x_gap + 40,
                            y: item['positionTop'] + y_gap,
                            color: item.color || color || null,
                            salable: (Math.ceil(Math.random() * 100)) % 2 == 1,
                            note: "note test",
                            tags: tags,
                            title: "Row: " + item.displayName + "\nLine: " + item['rowName']
                        }
                    });

                    let block = {
                        "id": block_i + 1,
                        "title": "Block " + (block_i + 1),
                        "labels": labels,
                        "color": color,
                        "seats": seats
                    };

                    blocks.push(block);
                    block_i++;
                }
                cb(blocks);

            });
        };

        getDummyBlocks(2, (blocks) => {
            console.log("adding blocks", blocks.length)
            seatmap.data.addBulkBlock(blocks);
        });


    });
</script>
</body>
</html>
